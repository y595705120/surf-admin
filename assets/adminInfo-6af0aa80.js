import{h as G,w as J,r as P,q as i,a8 as W,o as f,k as V,p as n,P as t,m as r,W as u,z as s,O as b,as as X,a5 as k,$ as Y,Z,Y as H}from"./vue-5a2488fc.js";import{s as w,e as Q,i as ee,m as z,X as ae,J as ne,G as oe,_ as te}from"./index-a237e875.js";import{b as I}from"./validate-8f99773c.js";const F="/admin/routine.AdminInfo/",x=new Map([["index",F+"index"],["edit",F+"edit"],["log","/admin/auth.AdminLog/index"]]);function le(){return w({url:x.get("index"),method:"get"})}function ie(c={}){return w({url:x.get("log"),method:"get",params:c})}function S(c){return w({url:x.get("edit"),method:"post",data:c},{showSuccessMessage:!0})}const de={class:"default-main"},se={class:"admin-info"},re={class:"image-slot"},me={class:"admin-info-base"},ue={class:"admin-nickname"},fe={class:"admin-other"},ce={class:"admin-info-form"},ge=G({name:"routine/adminInfo",__name:"adminInfo",setup(c){const{t:l}=Q(),g=J(),_=ee(),e=P({adminInfo:{},formKey:z(),buttonLoading:!1,log:[],logFilter:{limit:12},logCurrentPage:1,logPageSize:12,logTotal:100,logLoading:!0});le().then(o=>{e.adminInfo=o.data.info,e.formKey=z(),e.logFilter.search=[{field:"admin_id",val:o.data.info.id,operator:"eq"}],v()});const v=()=>{ie(e.logFilter).then(o=>{e.log=o.data.list,e.logTotal=o.data.total,e.logLoading=!1}).catch(()=>{e.logLoading=!1})},U=o=>{e.logPageSize=o,e.logFilter.limit=o,v()},D=o=>{e.logCurrentPage=o,e.logFilter.page=o,v()},$=P({nickname:[I({name:"required",title:l("routine.adminInfo.User nickname")})],email:[I({name:"email",title:l("routine.adminInfo.e-mail address")})],mobile:[I({name:"mobile",message:l("Please enter the correct field",{field:l("routine.adminInfo.phone number")})})],password:[I({name:"password"})]}),A=o=>{let a=new FormData;a.append("file",o.raw),oe(a).then(m=>{m.code==1&&S({id:e.adminInfo.id,avatar:m.data.file.url}).then(()=>{_.dataFill({..._.$state,avatar:m.data.file.full_url}),e.adminInfo.avatar=m.data.file.full_url})})},y=()=>{g.value&&g.value.validate(o=>{if(o){let a={...e.adminInfo};delete a.last_login_time,delete a.username,delete a.avatar,e.buttonLoading=!0,S(a).then(()=>{_.dataFill({..._.$state,nickname:e.adminInfo.nickname}),e.buttonLoading=!1}).catch(()=>{e.buttonLoading=!1})}})};return(o,a)=>{const m=i("Icon"),B=i("el-image"),K=i("el-upload"),h=i("el-input"),p=i("el-form-item"),C=i("el-button"),N=i("el-form"),L=i("el-col"),R=i("el-timeline-item"),T=i("el-timeline"),j=i("el-pagination"),q=i("el-card"),M=i("el-row"),O=W("loading");return f(),V("div",de,[n(M,{gutter:30},{default:t(()=>[n(L,{class:"lg-mb-20",xs:24,sm:24,md:24,lg:10},{default:t(()=>[r("div",se,[n(K,{class:"avatar-uploader",action:"","show-file-list":!1,onChange:A,"auto-upload":!1,accept:"image/gif, image/jpg, image/jpeg, image/bmp, image/png, image/webp"},{default:t(()=>[n(B,{src:e.adminInfo.avatar,class:"avatar"},{error:t(()=>[r("div",re,[n(m,{size:"30",color:"#c0c4cc",name:"el-icon-Picture"})])]),_:1},8,["src"])]),_:1}),r("div",me,[r("div",ue,u(e.adminInfo.nickname),1),r("div",fe,[r("div",null,u(s(l)("routine.adminInfo.Last logged in on"))+" "+u(e.adminInfo.last_login_time),1)])]),r("div",ce,[(f(),b(N,{onKeyup:a[5]||(a[5]=X(d=>y(),["enter"])),key:e.formKey,"label-position":"top",rules:$,ref_key:"formRef",ref:g,model:e.adminInfo},{default:t(()=>[n(p,{label:s(l)("routine.adminInfo.user name")},{default:t(()=>[n(h,{disabled:"",modelValue:e.adminInfo.username,"onUpdate:modelValue":a[0]||(a[0]=d=>e.adminInfo.username=d)},null,8,["modelValue"])]),_:1},8,["label"]),n(p,{label:s(l)("routine.adminInfo.User nickname"),prop:"nickname"},{default:t(()=>[n(h,{placeholder:s(l)("routine.adminInfo.Please enter a nickname"),modelValue:e.adminInfo.nickname,"onUpdate:modelValue":a[1]||(a[1]=d=>e.adminInfo.nickname=d)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(p,{label:s(l)("routine.adminInfo.New password"),prop:"password"},{default:t(()=>[n(h,{type:"password",placeholder:s(l)("routine.adminInfo.Please leave blank if not modified"),modelValue:e.adminInfo.password,"onUpdate:modelValue":a[2]||(a[2]=d=>e.adminInfo.password=d)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(p,null,{default:t(()=>[n(C,{type:"primary",loading:e.buttonLoading,onClick:a[3]||(a[3]=d=>y())},{default:t(()=>[k(u(s(l)("routine.adminInfo.Save changes")),1)]),_:1},8,["loading"]),n(C,{onClick:a[4]||(a[4]=d=>s(ae)(g.value))},{default:t(()=>[k(u(s(l)("Reset")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"]))])])]),_:1}),Y((f(),b(L,{xs:24,sm:24,md:24,lg:12},{default:t(()=>[n(q,{header:s(l)("routine.adminInfo.Operation log"),shadow:"never"},{default:t(()=>[n(T,null,{default:t(()=>[(f(!0),V(Z,null,H(e.log,(d,E)=>(f(),b(R,{key:E,size:"large",timestamp:s(ne)(d.create_time)},{default:t(()=>[k(u(d.title),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),n(j,{currentPage:e.logCurrentPage,"page-size":e.logPageSize,"page-sizes":[12,22,52,100],background:"",layout:"prev, next, jumper",total:e.logTotal,onSizeChange:U,onCurrentChange:D},null,8,["currentPage","page-size","total"])]),_:1},8,["header"])]),_:1})),[[O,e.logLoading]])]),_:1})])}}});const ve=te(ge,[["__scopeId","data-v-f44a5f5e"]]);export{ve as default};
